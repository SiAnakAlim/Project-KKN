<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Surat Keterangan Tidak Mampu</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        gold: {
                            400: '#e6b800',
                            500: '#d4a900',
                            600: '#c29a00',
                            700: '#b08b00',
                        },
                        golden: {
                            50: '#fff9e6',
                            100: '#fff2cc',
                            200: '#ffe699',
                        }
                    },
                    animation: {
                        'fade-in': 'fadeIn 0.3s ease-out',
                        'slide-up': 'slideUp 0.3s ease-out',
                        'pulse-slow': 'pulse 3s infinite'
                    },
                    keyframes: {
                        fadeIn: {
                            '0%': { opacity: '0' },
                            '100%': { opacity: '1' }
                        },
                        slideUp: {
                            '0%': { transform: 'translateY(10px)', opacity: '0' },
                            '100%': { transform: 'translateY(0)', opacity: '1' }
                        }
                    }
                }
            }
        }
    </script>
    <style>
        .sidebar-link {
            transition: all 0.2s ease;
        }
        .sidebar-link:hover {
            transform: translateX(4px);
            box-shadow: 2px 0 0 0 #d4a900 inset;
        }
        .card-hover {
            transition: all 0.3s ease;
        }
        .card-hover:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
        }
        .footer-link {
            transition: all 0.2s ease;
        }
        .footer-link:hover {
            color: '#d4a900';
            transform: translateY(-2px);
        }
        .active-menu {
            background-color: '#fff2cc';
            color: '#b08b00';
            font-weight: 600;
            border-left: 4px solid #d4a900;
        }
        .dropdown-content {
            display: none;
            position: absolute;
            right: 0;
            min-width: 280px;
            z-index: 50;
        }
        .show-dropdown {
            display: block;
            animation: fadeIn 0.3s;
        }
        .notification-badge {
            position: absolute;
            top: -5px;
            right: -5px;
        }
        .mobile-menu {
            transform: translateX(-100%);
            transition: transform 0.3s ease-in-out;
        }
        .mobile-menu.open {
            transform: translateX(0);
        }
        @media (min-width: 768px) {
            .mobile-menu {
                transform: translateX(0);
            }
        }
    </style>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body class="bg-gray-50">
    <div class="min-h-screen flex flex-col animate-fade-in">
        <!-- Header with gold gradient -->
        <nav class="bg-gradient-to-r from-gold-600 to-gold-500 p-4 text-white shadow-lg">
            <div class="container mx-auto flex justify-between items-center">
                <div class="flex items-center space-x-3 ml">
                    <div class="bg-white p-2 rounded-lg shadow-md">
                        <i class="fas fa-envelope-open-text text-gold-600 text-xl"></i>
                    </div>
                    <span class="text-xl font-bold tracking-wide">Sistem Surat Desa</span>
                </div>
                <div class="flex items-center space-x-4">
                    <div class="hidden md:block bg-gold-700 px-3 py-1 rounded-full text-sm font-medium animate-pulse-slow">
                        <i class="fas fa-circle text-xs mr-1"></i> Online
                    </div>
                </div>
            </div>
        </nav>

        <div class="flex flex-1 relative">
            <!-- Sidebar -->
            <button id="mobileMenuButton" class="md:hidden fixed top-4 left-4 bg-gold-500 text-white p-2 rounded-md shadow-md z-50">
                <i class="fas fa-bars"></i>
            </button>
            
           <!-- Sidebar -->
        <aside id="sidebar" class="mobile-menu fixed md:static inset-y-0 left-0 w-64 bg-white shadow-md p-4 border-r border-gray-200 z-50 md:block md:sticky md:top-0 md:h-screen overflow-y-auto">
            <div class="flex justify-between items-center mb-6 p-2 border-b border-gold-100 md:hidden">
                <h3 class="text-lg font-semibold">Menu Navigasi</h3>
                <button id="closeSidebar" class="text-gray-500 hover:text-gold-600">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <div class="mb-6 p-2 border-b border-gold-100">
                <h3 class="text-sm font-semibold text-gray-500 uppercase tracking-wider flex items-center">
                    <i class="fas fa-list-ul mr-2 text-gold-500"></i> Menu Surat
                </h3>
            </div>
            <ul class="space-y-2">
                <li>
                    <a href="/" class="sidebar-link flex items-center p-3 text-gray-700 hover:text-gold-700 hover:bg-golden-100 rounded-md transition-all animate-fade-in">
                        <i class="fas fa-home mr-3 text-gold-600 w-5 text-center"></i>
                        Beranda
                        <span class="ml-auto bg-gold-100 text-gold-700 text-xs px-2 py-1 rounded-full">Home</span>
                    </a>
                </li>
                <li>
                    <a href="/surat-sktm" class="sidebar-link flex items-center p-3 text-gray-700 hover:text-gold-700 hover:bg-golden-100 rounded-md transition-all animate-fade-in active-menu">
                        <i class="fas fa-hand-holding-usd mr-3 text-gold-600 w-5 text-center"></i>
                        Surat Keterangan Tidak Mampu
                    </a>
                </li>
                <li>
                    <a href="/surat-ku" class="sidebar-link flex items-center p-3 text-gray-700 hover:text-gold-700 hover:bg-golden-100 rounded-md transition-all animate-fade-in">
                        <i class="fas fa-briefcase mr-3 text-gold-600 w-5 text-center"></i>
                        Surat Keterangan Usaha
                    </a>
                </li>
                <li>
                    <a href="/surat-kbi" class="sidebar-link flex items-center p-3 text-gray-700 hover:text-gold-700 hover:bg-golden-100 rounded-md transition-all animate-fade-in">
                        <i class="fas fa-id-card mr-3 text-gold-600 w-5 text-center"></i>
                        Surat Beda Identitas
                    </a>
                </li>
                <li>
                    <a href="/surat-pengantar" class="sidebar-link flex items-center p-3 text-gray-700 hover:text-gold-700 hover:bg-golden-100 rounded-md transition-all animate-fade-in">
                        <i class="fas fa-envelope mr-3 text-gold-600 w-5 text-center"></i>
                        Surat Pengantar
                        <span class="ml-auto bg-gold-100 text-gold-700 text-xs px-2 py-1 rounded-full">New</span>
                    </a>
                </li>
            </ul>
        
            <div class="mt-8 mb-6 p-2 border-b border-gold-100">
                <h3 class="text-sm font-semibold text-gray-500 uppercase tracking-wider flex items-center">
                    <i class="fas fa-bell mr-2 text-gold-500"></i> Pemberitahuan & Riwayat
                </h3>
            </div>
            <ul class="space-y-2">
                <li>
                    <a href="/notifikasi" class="sidebar-link flex items-center p-3 text-gray-700 hover:text-gold-700 hover:bg-golden-100 rounded-md transition-all animate-fade-in">
                        <i class="fas fa-bell mr-3 text-gold-600 w-5 text-center"></i>
                        Pemberitahuan
                    </a>
                </li>
                <li>
                    <a href="/riwayat" class="sidebar-link flex items-center p-3 text-gray-700 hover:text-gold-700 hover:bg-golden-100 rounded-md transition-all animate-fade-in">
                        <i class="fas fa-history mr-3 text-gold-600 w-5 text-center"></i>
                        Riwayat
                    </a>
                </li>
            </ul>
        </aside>
            
            <div id="mobileOverlay" class="hidden fixed inset-0 bg-black opacity-50 z-40 md:hidden"></div>

            <main class="flex-1 p-6">
                <div class="bg-white rounded-lg shadow-md p-6 border border-gray-100">
                    <div class="flex justify-between items-center mb-6">
                        <h1 class="text-2xl font-bold text-gray-800">Daftar Surat Keterangan Tidak Mampu</h1>
                        <button id="addSuratSKTMBtn" class="flex items-center px-4 py-2 bg-gold-600 hover:bg-gold-700 text-white rounded-md shadow-sm transition-colors duration-200 border border-gold-700">
                            <i class="fas fa-plus mr-2 text-sm"></i> 
                            <span class="text-sm font-medium">Tambah Surat SKTM</span>
                        </button>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
                        <div class="bg-white border border-golden-100 rounded-lg p-4 shadow-sm hover:shadow-md transition-shadow">
                            <div class="flex justify-between items-center">
                                <div>
                                    <p class="text-gray-500 text-sm">Diproses</p>
                                    <p class="text-2xl font-bold text-gray-800"><%= statusCountsSKTM.diproses || 0 %></p>
                                </div>
                                <div class="bg-yellow-100 text-yellow-800 p-3 rounded-full">
                                    <i class="fas fa-clock text-xl"></i>
                                </div>
                            </div>
                        </div>
                        <div class="bg-white border border-golden-100 rounded-lg p-4 shadow-sm hover:shadow-md transition-shadow">
                            <div class="flex justify-between items-center">
                                <div>
                                    <p class="text-gray-500 text-sm">Selesai</p>
                                    <p class="text-2xl font-bold text-gray-800"><%= statusCountsSKTM.selesai || 0 %></p>
                                </div>
                                <div class="bg-green-100 text-green-800 p-3 rounded-full">
                                    <i class="fas fa-check-circle text-xl"></i>
                                </div>
                            </div>
                        </div>
                        <div class="bg-white border border-golden-100 rounded-lg p-4 shadow-sm hover:shadow-md transition-shadow">
                            <div class="flex justify-between items-center">
                                <div>
                                    <p class="text-gray-500 text-sm">Ditolak</p>
                                    <p class="text-2xl font-bold text-gray-800"><%= statusCountsSKTM.ditolak || 0 %></p>
                                </div>
                                <div class="bg-red-100 text-red-800 p-3 rounded-full">
                                    <i class="fas fa-times-circle text-xl"></i>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="flex flex-col md:flex-row justify-between items-start md:items-center mb-6 gap-4">
                        <div class="flex flex-wrap gap-3">
                            <!-- Status Filter -->
                            <div class="relative w-full md:w-auto">
                                <label for="statusFilterSKTM" class="sr-only">Filter Status</label>
                                <div class="flex items-center">
                                    <select id="statusFilterSKTM" class="appearance-none bg-white border border-gray-300 rounded-md pl-3 pr-8 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-gold-500 focus:border-gold-500">
                                        <option value="semua">Semua Status</option>
                                        <option value="Diproses">Diproses</option>
                                        <option value="Selesai">Selesai</option>
                                        <option value="Ditolak">Ditolak</option>
                                    </select>
                                    <div class="pointer-events-none absolute inset-y-0 right-0 flex items-center px-2 text-gray-500">
                                        <i class="fas fa-chevron-down text-xs"></i>
                                    </div>
                                </div>
                            </div>
                    
                            <!-- Items Per Page -->
                            <div class="relative w-full md:w-auto">
                                <label for="perPageSKTM" class="sr-only">Data per Halaman</label>
                                <div class="flex items-center">
                                    <select id="perPageSKTM" class="appearance-none bg-white border border-gray-300 rounded-md pl-3 pr-8 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-gold-500 focus:border-gold-500">
                                        <option value="5">5 per halaman</option>
                                        <option value="10" selected>10 per halaman</option>
                                        <option value="15">15 per halaman</option>
                                        <option value="20">20 per halaman</option>
                                    </select>
                                    <div class="pointer-events-none absolute inset-y-0 right-0 flex items-center px-2 text-gray-500">
                                        <i class="fas fa-chevron-down text-xs"></i>
                                    </div>
                                </div>
                            </div>
                        </div>
                    
                        <!-- Search Input -->
                        <div class="relative w-full md:w-64">
                            <label for="searchInputSKTM" class="sr-only">Cari</label>
                            <div class="relative">
                                <input type="text" id="searchInputSKTM" placeholder="Cari nomor surat atau nama..."
                                       class="w-full pl-10 pr-4 py-2 border border-gray-300 rounded-md text-sm focus:outline-none focus:ring-2 focus:ring-gold-500 focus:border-gold-500">
                                <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                                    <i class="fas fa-search text-gray-400 text-sm"></i>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="overflow-x-auto">
                        <table class="w-full border-collapse">
                            <thead>
                                <tr class="bg-golden-50 text-left">
                                    <th class="p-3 font-semibold text-gray-700">Nomor</th>
                                    <th class="p-3 font-semibold text-gray-700">Nomor Surat</th>
                                    <th class="p-3 font-semibold text-gray-700">Nama</th>
                                    <th class="p-3 font-semibold text-gray-700">Tanggal Permohonan</th>
                                    <th class="p-3 font-semibold text-gray-700">Status</th>
                                    <th class="p-3 font-semibold text-gray-700 text-right">Aksi</th>
                                </tr>
                            </thead>
                            <tbody>
                                <% if (suratSKTM.length > 0) { %>
                                    <%
                                        // Hitung offset untuk nomor urut
                                        const offsetSKTM = (currentPageSKTM - 1) * perPageSKTM;
                                        suratSKTM.forEach((row, index) => { %>
                                            <tr class="border-b hover:bg-golden-50 transition-colors">
                                                <td class="p-3 text-gray-800"><%= offsetSKTM + index + 1 %></td>
                                                <td class="p-3 text-gray-800"><%= row.nomor_surat %></td>
                                                <td class="p-3 text-gray-800"><%= row.nama %></td>
                                                <td class="p-3 text-gray-800"><%= new Date(row.tanggal_permohonan).toLocaleDateString('id-ID') %></td>
                                                <td class="p-3">
                                                    <% if (row.status === 'Diproses') { %>
                                                        <span class="px-3 py-1 rounded-full text-xs font-semibold bg-yellow-100 text-yellow-800">
                                                            <i class="fas fa-clock mr-1"></i> Diproses
                                                        </span>
                                                    <% } else if (row.status === 'Selesai') { %>
                                                        <span class="px-3 py-1 rounded-full text-xs font-semibold bg-green-100 text-green-800">
                                                            <i class="fas fa-check-circle mr-1"></i> Selesai
                                                        </span>
                                                    <% } else if (row.status === 'Ditolak') { %>
                                                        <span class="px-3 py-1 rounded-full text-xs font-semibold bg-red-100 text-red-800">
                                                            <i class="fas fa-times-circle mr-1"></i> Ditolak
                                                        </span>
                                                    <% } %>
                                                </td>
                                                <td class="p-3 text-right">
                                                    <div class="flex justify-end space-x-2">
                                                        <a href="/surat-sktm/<%= row.id %>"
                                                           class="text-gold-600 hover:text-gold-800 p-1 rounded hover:bg-golden-50"
                                                           title="Detail">
                                                            <i class="fas fa-eye"></i>
                                                        </a>
                                                        <a href="/cetak-surat-sktm/<%= row.id %>"
                                                           class="text-green-600 hover:text-green-800 p-1 rounded hover:bg-green-50"
                                                           title="Cetak">
                                                            <i class="fas fa-print"></i>
                                                        </a>
                                                        <button onclick="editSuratSKTM('<%= row.id %>')"
                                                                class="text-purple-600 hover:text-purple-800 p-1 rounded hover:bg-purple-50"
                                                                title="Edit">
                                                            <i class="fas fa-edit"></i>
                                                        </button>
                                                        <% if (row.status === 'Selesai' && row.nomor_wa) { %>
                                                            <a href="https://wa.me/<%= row.nomor_wa %>?text=Yth.%20<%= encodeURIComponent(row.nama) %>,%0ASurat%20Keterangan%20Tidak%20Mampu%20Anda%20dengan%20nomor%20<%= encodeURIComponent(row.nomor_surat) %>%20sudah%20selesai.%20Anda%20bisa%20mengambil%20di%20balai%20desa%20pukul%2008.00%20-%2015.00."
                                                               class="inline-flex items-center p-1 rounded hover:bg-teal-100 text-teal-600 hover:text-teal-800"
                                                               title="Kirim WA"
                                                               target="_blank">
                                                                <i class="fab fa-whatsapp text-lg"></i>
                                                            </a>
                                                        <% } %>
                                                    </div>
                                                </td>
                                            </tr>
                                        <% }) %>
                                <% } else { %>
                                    <tr>
                                        <td colspan="6" class="p-4 text-center text-gray-500">
                                            <i class="fas fa-inbox text-3xl mb-2 text-gray-300"></i>
                                            <p>Tidak ada data surat keterangan tidak mampu.</p>
                                        </td>
                                    </tr>
                                <% } %>
                            </tbody>
                        </table>
                    </div>
                    <div class="flex justify-between items-center mt-6">
                        <div class="text-sm text-gray-600">
                            Menampilkan <%= currentPageSKTM * perPageSKTM - perPageSKTM + 1 %>-<%= Math.min(currentPageSKTM * perPageSKTM, totalItemsSKTM) %> dari <%= totalItemsSKTM %> surat
                        </div>
                        <div class="flex space-x-2">
                            <% if (totalPagesSKTM > 1) { %>
                                <% if (currentPageSKTM > 1) { %>
                                    <a href="?page=<%= currentPageSKTM - 1 %>&perPage=<%= perPageSKTM %>&status=<%= currentStatusSKTM %>&search=<%= currentSearchSKTM %>"
                                       class="inline-flex items-center justify-center px-3 py-1 rounded text-gray-500 bg-white hover:bg-gray-100">
                                        <i class="fas fa-chevron-left text-sm"></i>
                                    </a>
                                <% } %>
                    
                                <% for (let i = 1; i <= totalPagesSKTM; i++) { %>
                                    <a href="?page=<%= i %>&perPage=<%= perPageSKTM %>&status=<%= currentStatusSKTM %>&search=<%= currentSearchSKTM %>"
                                       class="inline-flex items-center justify-center px-3 py-1 rounded hover:bg-gray-100 <%= i === currentPageSKTM ? 'bg-gold-600 text-white hover:bg-gold-700' : 'text-gray-700 bg-white' %>">
                                        <%= i %>
                                    </a>
                                <% } %>
                    
                                <% if (currentPageSKTM < totalPagesSKTM) { %>
                                    <a href="?page=<%= currentPageSKTM + 1 %>&perPage=<%= perPageSKTM %>&status=<%= currentStatusSKTM %>&search=<%= currentSearchSKTM %>"
                                       class="inline-flex items-center justify-center px-3 py-1 rounded text-gray-500 bg-white hover:bg-gray-100">
                                        <i class="fas fa-chevron-right text-sm"></i>
                                    </a>
                                <% } %>
                            <% } %>
                        </div>
                    </div>
                </div>
                
                <!-- Add Surat Modal -->
                <div id="addSuratSKTMModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center hidden z-50 p-4">
                    <div class="bg-white rounded-lg shadow-xl w-full max-w-2xl max-h-screen overflow-y-auto">
                        <div class="flex justify-between items-center border-b p-4">
                            <h3 class="text-xl font-semibold text-gray-800">Tambah Surat Keterangan Tidak Mampu</h3>
                            <button id="closeAddSKTMModal" class="text-gray-500 hover:text-gray-700">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                        <form id="addSuratSKTMForm" class="p-4 md:p-6">
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 md:gap-6">
                                <!-- Data Pemohon -->
                                <div class="md:col-span-2">
                                    <h4 class="font-medium text-gray-700 mb-3">Data Pemohon</h4>
                                </div>
                                
                                <div>
                                    <label for="new_nama" class="block text-sm font-medium text-gray-700 mb-1">Nama Lengkap*</label>
                                    <input type="text" id="new_nama" name="nama" required
                                        class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-gold-500 text-sm">
                                </div>

                                <div>
                                    <label for="new_no_kk" class="block text-sm font-medium text-gray-700 mb-1">Nomor KK*</label>
                                    <input type="text" id="new_no_kk" name="no_kk" required
                                        pattern="\d{16}" title="Nomor KK harus 16 digit angka"
                                        class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-gold-500 text-sm">
                                    <p class="text-xs text-gray-500 mt-1">16 digit angka</p>
                                </div>

                                <div>
                                    <label for="new_nik" class="block text-sm font-medium text-gray-700 mb-1">NIK*</label>
                                    <input type="text" id="new_nik" name="nik" required
                                        pattern="\d{16}" title="NIK harus 16 digit angka"
                                        class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-gold-500 text-sm">
                                    <p class="text-xs text-gray-500 mt-1">16 digit angka</p>
                                </div>

                                <div>
                                    <label for="new_tempat_tanggal_lahir" class="block text-sm font-medium text-gray-700 mb-1">Tempat/Tgl Lahir*</label>
                                    <input type="text" id="new_tempat_tanggal_lahir" name="tempat_tanggal_lahir" required
                                        placeholder="Contoh: Klaten, 17 Agustus 1945"
                                        class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-gold-500 text-sm">
                                </div>

                        
                                <div>
                                    <label for="new_jenis_kelamin" class="block text-sm font-medium text-gray-700 mb-1">Jenis Kelamin*</label>
                                    <select id="new_jenis_kelamin" name="jenis_kelamin" required
                                        class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-gold-500 text-sm">
                                        <option value="">Pilih Jenis Kelamin</option>
                                        <option value="L">L</option>
                                        <option value="P">P</option>
                                    </select>
                                </div>

                                <div>
                                    <label for="new_alamat" class="block text-sm font-medium text-gray-700 mb-1">Alamat*</label>
                                    <input type="text" id="new_alamat" name="alamat" required
                                        class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-gold-500 text-sm">
                                </div>

                                <div>
                                    <label for="new_nomor_hp" class="block text-sm font-medium text-gray-700 mb-1">Nomor HP</label>
                                    <input type="tel" id="new_nomor_hp" name="nomor_hp"
                                        class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-gold-500 text-sm">
                                </div>

                                <!-- Auto-generated Info -->
                                <div class="md:col-span-2 p-4 bg-gray-50 rounded-lg mt-2">
                                    <h4 class="font-medium text-gray-700 mb-3">Informasi Sistem</h4>
                                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                        <div>
                                            <p class="text-xs text-gray-500 mb-1">Nomor Surat</p>
                                            <p id="display_nomor_surat_sktm" class="text-sm font-medium text-gray-800">Akan digenerate otomatis</p>
                                        </div>
                                        <div>
                                            <p class="text-xs text-gray-500 mb-1">Jenis Surat</p>
                                            <p class="text-sm font-medium text-gray-800">Keterangan Tidak Mampu</p>
                                        </div>
                                        <div>
                                            <p class="text-xs text-gray-500 mb-1">Tanggal Permohonan</p>
                                            <p id="display_tanggal_sktm" class="text-sm font-medium text-gray-800"></p>
                                        </div>
                                        <div>
                                            <p class="text-xs text-gray-500 mb-1">Status</p>
                                            <p class="text-sm font-medium text-gray-800">Diproses</p>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Form Actions -->
                            <div class="mt-6 flex justify-end space-x-3">
                                <button type="button" id="cancelAddSKTMModal" class="px-4 py-2 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-100 text-sm">
                                    Batal
                                </button>
                                <button type="submit" class="px-4 py-2 bg-gold-600 text-white rounded-md hover:bg-gold-700 text-sm">
                                    <i class="fas fa-save mr-2"></i> Simpan
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
                
                 <!-- Edit Surat Modal -->
                 <div id="editSuratSKTMModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center hidden z-50">
                    <div class="bg-white rounded-lg shadow-xl w-full max-w-2xl max-h-screen overflow-y-auto">
                        <div class="flex justify-between items-center border-b p-4">
                            <h3 class="text-xl font-semibold text-gray-800">Edit Surat Keterangan Tidak Mampu</h3>
                            <button id="closeEditSKTMModal" class="text-gray-500 hover:text-gray-700">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                        <form id="editSuratSKTMForm" class="p-6">
                            <input type="hidden" id="edit_id_sktm" name="id">
                            <input type="hidden" id="edit_jenis_surat" name="jenis_surat" value="sktm">
                            <input type="hidden" id="edit_tanggal_permohonan" name="tanggal_permohonan">
                
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                <div>
                                    <label for="edit_nama" class="block text-sm font-medium text-gray-700 mb-1">Nama Lengkap*</label>
                                    <input type="text" id="edit_nama" name="nama" required
                                        class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-gold-500">
                                </div>
                
                                <div>
                                    <label for="edit_no_kk" class="block text-sm font-medium text-gray-700 mb-1">Nomor KK*</label>
                                    <input type="text" id="edit_no_kk" name="no_kk" required
                                        class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-gold-500">
                                </div>
                
                                <div>
                                    <label for="edit_nik" class="block text-sm font-medium text-gray-700 mb-1">NIK*</label>
                                    <input type="text" id="edit_nik" name="nik" required
                                        class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-gold-500">
                                </div>
                
                                <div>
                                    <label for="edit_tempat_tanggal_lahir" class="block text-sm font-medium text-gray-700 mb-1">Tempat/Tgl Lahir*</label>
                                    <input type="text" id="edit_tempat_tanggal_lahir" name="tempat_tanggal_lahir" required
                                        class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-gold-500">
                                </div>
                
                               <!-- Di dalam form editSuratSKTMForm -->
<div>
    <label for="edit_jenis_kelamin" class="block text-sm font-medium text-gray-700 mb-1">Jenis Kelamin*</label>
    <select id="edit_jenis_kelamin" name="jenis_kelamin" required
        class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-gold-500">
        <option value="L">L</option>
        <option value="P">P</option>
    </select>
</div>
                
                                <div>
                                    <label for="edit_alamat" class="block text-sm font-medium text-gray-700 mb-1">Alamat*</label>
                                    <input type="text" id="edit_alamat" name="alamat" required
                                        class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-gold-500">
                                </div>
                
                                <div>
                                    <label for="edit_nomor_hp" class="block text-sm font-medium text-gray-700 mb-1">Nomor HP</label>
                                    <input type="tel" id="edit_nomor_hp" name="nomor_hp"
                                        pattern="08[0-9]{9,11}"
                                        title="Nomor HP harus dimulai dengan 08 dan minimal 11 digit"
                                        class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-gold-500">
                                    <p class="text-xs text-gray-500 mt-1">Format: 08xxxxxxxx (10-13 digit)</p>
                                </div>
                
                                <div>
                                    <label for="edit_status_sktm" class="block text-sm font-medium text-gray-700 mb-1">Status*</label>
                                    <select id="edit_status_sktm" name="status" required
                                        class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-gold-500">
                                        <option value="Diproses">Diproses</option>
                                        <option value="Selesai">Selesai</option>
                                        <option value="Ditolak">Ditolak</option>
                                    </select>
                                </div>
                
                                <div id="whatsappButtonEditSKTM" class="md:col-span-2 mt-4">
                                </div>
                            </div>
                
                            <div class="mt-6 flex justify-end space-x-3">
                                <button type="button" id="cancelEditSKTMModal" class="px-4 py-2 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-100">
                                    Batal
                                </button>
                                <button type="submit" class="px-4 py-2 bg-gold-600 text-white rounded-md hover:bg-gold-700">
                                    <i class="fas fa-save mr-2"></i> Simpan Perubahan
                                </button>
                            </div>
                        </form>
                    </div>
                    
                </div>
            </main>
        </div>

        <!-- Footer -->
        <footer class="bg-gray-800 text-white">
            <div class="container mx-auto px-4 md:px-6 py-6 md:py-8">
                <div class="flex flex-col md:flex-row justify-between">
                    <div class="mb-8 md:mb-0">
                        <div class="flex items-center mb-4">
                            <div class="bg-gold-500 p-2 rounded-lg mr-3">
                                <i class="fas fa-envelope-open-text text-white"></i>
                            </div>
                            <span class="text-lg md:text-xl font-bold">Sistem Surat Desa</span>
                        </div>
                        <p class="text-gray-400 text-xs md:text-sm max-w-xs">
                            Sistem pelayanan surat menyurat digital untuk mempermudah administrasi warga Desa Kebondalem Kidul.
                        </p>
                        <p class="text-gold-400 font-semibold mt-3 md:mt-4 text-sm md:text-base">© 2025 Tim KKN Sowan Sojiwan</p>
                    </div>
        
                    <div class="grid grid-cols-2 md:grid-cols-3 gap-6 md:gap-8">
                        <div>
                            <h3 class="text-gold-400 font-semibold mb-3 md:mb-4 text-base md:text-lg">Navigasi</h3>
                            <ul class="space-y-1 md:space-y-2">
                                <li><a href="/" class="footer-link text-xs md:text-sm text-gray-300 hover:text-gold-400">Beranda</a></li>
                                
                                <li class="relative group">
                                    <a href="#" class="footer-link text-xs md:text-sm text-gray-300 hover:text-gold-400 flex items-center">
                                        Surat 
                                        <i class="fas fa-caret-down ml-1 text-gray-400 transition-transform duration-300 group-hover:rotate-180"></i>
                                    </a>
                        
                                    <!-- Dropdown -->
                                    <ul class="absolute left-0 top-full mt-2 w-56 bg-gray-700 rounded-md shadow-lg opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-300 ease-out z-20">
                                        <li>
                                            <a href="/surat-pengantar" class="block px-4 py-2 text-xs md:text-sm text-gray-300 hover:text-gold-400 whitespace-nowrap">Surat Pengantar</a>
                                        </li>
                                        <li>
                                            <a href="/surat-tidak-mampu" class="block px-4 py-2 text-xs md:text-sm text-gray-300 hover:text-gold-400 whitespace-nowrap">Surat Keterangan Tidak Mampu</a>
                                        </li>
                                        <li>
                                            <a href="/surat-beda-identitas" class="block px-4 py-2 text-xs md:text-sm text-gray-300 hover:text-gold-400 whitespace-nowrap">Surat Keterangan Beda Identitas</a>
                                        </li>
                                        <li>
                                            <a href="/surat-usaha" class="block px-4 py-2 text-xs md:text-sm text-gray-300 hover:text-gold-400 whitespace-nowrap">Surat Keterangan Usaha</a>
                                        </li>
                                    </ul>
                                </li>
                        
                                <li><a href="/riwayat" class="footer-link text-xs md:text-sm text-gray-300 hover:text-gold-400">Riwayat</a></li>
                                <li><a href="/notifikasi" class="footer-link text-xs md:text-sm text-gray-300 hover:text-gold-400">Pemberitahuan</a></li>
                            </ul>
                        </div>
                        
                        
        
                        <div>
                            <h3 class="text-gold-400 font-semibold mb-3 md:mb-4 text-base md:text-lg">Bantuan</h3>
                            <ul class="space-y-1 md:space-y-2">
                                <li><a href="/tutorial-penggunaan" class="footer-link text-xs md:text-sm text-gray-300 hover:text-gold-400">Tutorial Penggunaan</a></li>
                                <li><a href="/faq" class="footer-link text-xs md:text-sm text-gray-300 hover:text-gold-400">FAQ</a></li>
                                <li><a href="/kebijakan-privasi" class="footer-link text-xs md:text-sm text-gray-300 hover:text-gold-400">Kebijakan Privasi</a></li>
                                <li><a href="/syarat-ketentuan" class="footer-link text-xs md:text-sm text-gray-300 hover:text-gold-400">Syarat & Ketentuan</a></li>
                            </ul>
                        </div>
        
                        <div>
                            <h3 class="text-gold-400 font-semibold mb-3 md:mb-4 text-base md:text-lg">Kontak</h3>
                            <ul class="space-y-1 md:space-y-2">
                                <li class="flex items-start">
                                    <i class="fas fa-map-marker-alt text-gold-400 mr-2 mt-1 text-xs md:text-sm"></i>
                                    <span class="text-xs md:text-sm text-gray-300">Desa Kebondalem Kidul, Jawa Tengah</span>
                                </li>
                                <li class="flex items-start">
                                    <i class="fas fa-envelope text-gold-400 mr-2 mt-1 text-xs md:text-sm"></i>
                                    <a href="mailto:desakebondalemkidul@gmail.com" class="footer-link text-xs md:text-sm text-gray-300 hover:text-gold-400">desakebondalemkidul@gmail.com</a>
                                </li>
                                <li class="flex items-start">
                                    <i class="fas fa-phone-alt text-gold-400 mr-2 mt-1 text-xs md:text-sm"></i>
                                    <a href="tel:+62895323350805" class="footer-link text-xs md:text-sm text-gray-300 hover:text-gold-400">+62 8953-2335-0805</a>
                                </li>
                            </ul>
                            <div class="mt-3 md:mt-4 flex space-x-3 md:space-x-4">
                                <a href="https://www.instagram.com/sowansojiwan" class="footer-link text-gray-300 hover:text-gold-400 text-base md:text-xl">
                                    <i class="fab fa-instagram"></i>
                                </a>
                                <a href="https://wa.me/628562519826" class="footer-link text-gray-300 hover:text-gold-400 text-base md:text-xl">
                                    <i class="fab fa-whatsapp"></i>
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
        
                <div class="border-t border-gray-700 mt-6 md:mt-8 pt-4 md:pt-6 text-center">
                    <p class="text-gray-400 text-xs md:text-sm">
                        Sistem ini dikembangkan oleh Tim KKN UPN "VETERAN" YOGYAKARTA 2025 untuk Desa Kebondalem Kidul
                    </p>
                </div>
            </div>
        </footer>
    </div>


    <script>
        // Mobile sidebar toggle
        const mobileMenuButton = document.getElementById('mobileMenuButton');
        const closeSidebar = document.getElementById('closeSidebar');
        const sidebar = document.getElementById('sidebar');
        const mobileOverlay = document.getElementById('mobileOverlay');
    
        if (mobileMenuButton && closeSidebar && sidebar && mobileOverlay) {
            mobileMenuButton.addEventListener('click', function() {
                sidebar.classList.add('open');
                mobileOverlay.classList.remove('hidden');
                document.body.style.overflow = 'hidden';
            });
    
            closeSidebar.addEventListener('click', function() {
                sidebar.classList.remove('open');
                mobileOverlay.classList.add('hidden');
                document.body.style.overflow = '';
            });
    
            mobileOverlay.addEventListener('click', function() {
                sidebar.classList.remove('open');
                mobileOverlay.classList.add('hidden');
                document.body.style.overflow = '';
            });
    
            // Close sidebar when clicking a link (for mobile)
            const sidebarLinks = document.querySelectorAll('.sidebar-link');
            sidebarLinks.forEach(link => {
                link.addEventListener('click', function() {
                    if (window.innerWidth < 768) {
                        sidebar.classList.remove('open');
                        mobileOverlay.classList.add('hidden');
                        document.body.style.overflow = '';
                    }
                });
            });
        }
    
        // Toggle notification dropdown
        const notificationBtn = document.getElementById('notificationBtn');
        const notificationDropdown = document.getElementById('notificationDropdown');
        if (notificationBtn && notificationDropdown) {
            notificationBtn.addEventListener('click', function() {
                notificationDropdown.classList.toggle('show-dropdown');
                document.getElementById('historyDropdown')?.classList.remove('show-dropdown');
            });
        }
    
        // Toggle history dropdown
        const historyBtn = document.getElementById('historyBtn');
        const historyDropdown = document.getElementById('historyDropdown');
        if (historyBtn && historyDropdown) {
            historyBtn.addEventListener('click', function() {
                historyDropdown.classList.toggle('show-dropdown');
                document.getElementById('notificationDropdown')?.classList.remove('show-dropdown');
            });
        }
    
        // Close dropdowns when clicking outside
        window.addEventListener('click', function(event) {
            if (notificationBtn && notificationDropdown && !event.target.matches('#notificationBtn') && !event.target.closest('#notificationDropdown')) {
                notificationDropdown.classList.remove('show-dropdown');
            }
            if (historyBtn && historyDropdown && !event.target.matches('#historyBtn') && !event.target.closest('#historyDropdown')) {
                historyDropdown.classList.remove('show-dropdown');
            }
        });
    
        // Adjust main content margin when sidebar is toggled
        function adjustContentMargin() {
            const sidebarElement = document.querySelector('aside');
            if (sidebarElement) {
                const sidebarWidth = sidebarElement.offsetWidth;
                const mainElement = document.querySelector('main');
                if (mainElement) {
                    if (window.innerWidth >= 768) {
                        mainElement.style.marginLeft = `${sidebarWidth}px`;
                    } else {
                        mainElement.style.marginLeft = '0';
                    }
                }
            }
        }
    </script>
    
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // ==================== CONSTANTS ====================
            const API_BASE_URL = '/api/surat-sktm';
            const SKTM_API_URL = '/surat-sktm';
            
            // ==================== DOM ELEMENTS ====================
            // Modal Elements
            const addSuratSKTMBtn = document.getElementById('addSuratSKTMBtn');
            const addSuratSKTMModal = document.getElementById('addSuratSKTMModal');
            const closeAddSKTMModal = document.getElementById('closeAddSKTMModal');
            const cancelAddSKTMModal = document.getElementById('cancelAddSKTMModal');
            const addSuratSKTMForm = document.getElementById('addSuratSKTMForm');
            
            const editSuratSKTMModal = document.getElementById('editSuratSKTMModal');
            const closeEditSKTMModal = document.getElementById('closeEditSKTMModal');
            const cancelEditSKTMModal = document.getElementById('cancelEditSKTMModal');
            const editSuratSKTMForm = document.getElementById('editSuratSKTMForm');
            
            // Filter Elements
            const statusFilterSKTM = document.getElementById('statusFilterSKTM');
            const perPageFilterSKTM = document.getElementById('perPageSKTM');
            const searchInputSKTM = document.getElementById('searchInputSKTM');
            
            // Form Elements
            const displayNomorSuratSKTM = document.getElementById('display_nomor_surat_sktm');
            const displayTanggalSKTMElement = document.getElementById('display_tanggal_sktm');
        
            // ==================== UTILITY FUNCTIONS ====================
            /**
             * Show notification to user
             * @param {string} message - Notification message
             * @param {string} type - Notification type (success, error, warning, info)
             */
            function showNotification(message, type = 'success') {
                const colors = { 
                    success: 'bg-green-500', 
                    error: 'bg-red-500', 
                    warning: 'bg-yellow-500', 
                    info: 'bg-blue-500' 
                };
                const icons = { 
                    success: 'fa-check-circle', 
                    error: 'fa-exclamation-circle', 
                    warning: 'fa-exclamation-triangle', 
                    info: 'fa-info-circle' 
                };
        
                const notification = document.createElement('div');
                notification.className = `fixed top-4 right-4 ${colors[type]} text-white px-4 py-2 rounded-md shadow-lg flex items-center animate-fade-in z-50`;
                notification.innerHTML = `<i class="fas ${icons[type]} mr-2"></i><span>${message}</span>`;
                document.body.appendChild(notification);
        
                setTimeout(() => {
                    notification.classList.add('opacity-0', 'transition-opacity', 'duration-300');
                    setTimeout(() => notification.remove(), 300);
                }, 3000);
            }
        
            /**
             * Format date to Indonesian locale
             * @param {string} dateString - Date string to format
             * @returns {string} Formatted date
             */
            function formatIndonesianDate(dateString) {
                try {
                    const options = { year: 'numeric', month: 'long', day: 'numeric' };
                    return new Date(dateString).toLocaleDateString('id-ID', options);
                } catch (error) {
                    console.error('Error formatting date:', error);
                    return dateString || 'Tanggal tidak valid';
                }
            }
        
            /**
             * Validate NIK and KK format
             * @param {string} value - Value to validate
             * @param {string} type - 'nik' or 'kk'
             * @returns {boolean} True if valid
             */
            function validateNumberFormat(value, type) {
                const regex = /^\d{16}$/;
                if (!regex.test(value)) {
                    showNotification(`${type === 'nik' ? 'NIK' : 'Nomor KK'} harus 16 digit angka`, 'error');
                    return false;
                }
                return true;
            }
        
            // ==================== FILTER FUNCTIONS ====================
            /**
             * Initialize filters from URL parameters
             */
            function initializeFilters() {
                const urlParams = new URLSearchParams(window.location.search);
                if (urlParams.has('status')) statusFilterSKTM.value = urlParams.get('status');
                if (urlParams.has('perPage')) perPageFilterSKTM.value = urlParams.get('perPage');
                if (urlParams.has('search')) searchInputSKTM.value = urlParams.get('search');
            }
        
            /**
             * Update filters in URL
             */
            function updateFilters() {
                const params = new URLSearchParams();
                if (statusFilterSKTM.value !== 'semua') params.set('status', statusFilterSKTM.value);
                if (perPageFilterSKTM.value !== '10') params.set('perPage', perPageFilterSKTM.value);
                if (searchInputSKTM.value.trim() !== '') params.set('search', searchInputSKTM.value.trim());
                params.set('page', '1'); // Reset to first page when filters change
                window.location.search = params.toString();
            }
        
            /**
             * Setup filter event listeners
             */
            function setupFilterListeners() {
                if (statusFilterSKTM) statusFilterSKTM.addEventListener('change', updateFilters);
                if (perPageFilterSKTM) perPageFilterSKTM.addEventListener('change', updateFilters);
                if (searchInputSKTM) {
                    let searchTimeout;
                    searchInputSKTM.addEventListener('input', () => {
                        clearTimeout(searchTimeout);
                        searchTimeout = setTimeout(updateFilters, 500);
                    });
                    searchInputSKTM.addEventListener('keypress', (e) => {
                        if (e.key === 'Enter') updateFilters();
                    });
                }
            }
        
            // ==================== MODAL FUNCTIONS ====================
            /**
             * Setup modal controls
             */
            function setupModalControls() {
                // Add Surat SKTM Modal
                if (addSuratSKTMBtn && addSuratSKTMModal) {
                    addSuratSKTMBtn.addEventListener('click', () => {
                        addSuratSKTMModal.classList.remove('hidden');
                        displayTanggalSKTM();
                        displayNomorSuratSKTM.textContent = 'Akan digenerate otomatis';
                    });
                }
        
                if (closeAddSKTMModal && cancelAddSKTMModal) {
                    const closeAddModal = () => addSuratSKTMModal.classList.add('hidden');
                    closeAddSKTMModal.addEventListener('click', closeAddModal);
                    cancelAddSKTMModal.addEventListener('click', closeAddModal);
                }
        
                // Edit Surat SKTM Modal
                if (closeEditSKTMModal && cancelEditSKTMModal) {
                    const closeEditModal = () => editSuratSKTMModal.classList.add('hidden');
                    closeEditSKTMModal.addEventListener('click', closeEditModal);
                    cancelEditSKTMModal.addEventListener('click', closeEditModal);
                }
            }
        
            /**
             * Display current date in add form
             */
            function displayTanggalSKTM() {
                const now = new Date();
                displayTanggalSKTMElement.textContent = formatIndonesianDate(now);
            }
        
            // ==================== FORM HANDLERS ====================
            /**
             * Setup form handlers
             */
            function setupFormHandlers() {
                // Add Surat SKTM Form
                if (addSuratSKTMForm) {
                    addSuratSKTMForm.addEventListener('submit', async (e) => {
                        e.preventDefault();
        
                        // Get form elements
                        const nikInput = document.getElementById('new_nik');
                        const kkInput = document.getElementById('new_no_kk');
                        
                        // Validate inputs
                        if (!validateNumberFormat(nikInput.value, 'nik')) return;
                        if (!validateNumberFormat(kkInput.value, 'kk')) return;
        
                        // Prepare form data
                        const formData = {
                            nama: document.getElementById('new_nama').value.trim(),
                            no_kk: kkInput.value,
                            nik: nikInput.value,
                            tempat_tanggal_lahir: document.getElementById('new_tempat_tanggal_lahir').value.trim(),
                            jenis_kelamin: document.getElementById('new_jenis_kelamin').value,
                            alamat: document.getElementById('new_alamat').value.trim(),
                            nomor_hp: document.getElementById('new_nomor_hp').value.trim(),
                            jenis_surat: 'sktm'
                        };
        
                        // Validate required fields
                        if (!formData.nama || !formData.tempat_tanggal_lahir || !formData.jenis_kelamin || !formData.alamat) {
                            showNotification('Semua field yang wajib diisi harus dilengkapi', 'error');
                            return;
                        }
        
                        try {
                            // Show loading state
                            const submitBtn = addSuratSKTMForm.querySelector('button[type="submit"]');
                            const originalBtnText = submitBtn.innerHTML;
                            submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i> Menyimpan...';
                            submitBtn.disabled = true;
        
                            const response = await fetch(SKTM_API_URL, {
                                method: 'POST',
                                headers: { 'Content-Type': 'application/json' },
                                body: JSON.stringify(formData)
                            });
        
                            const result = await response.json();
        
                            // Restore button state
                            submitBtn.innerHTML = originalBtnText;
                            submitBtn.disabled = false;
        
                            if (response.ok && result.success) {
                                showNotification('Surat SKTM berhasil ditambahkan', 'success');
                                setTimeout(() => window.location.reload(), 1500);
                            } else {
                                const errorMsg = result.message || 'Gagal menambahkan Surat SKTM';
                                if (result.error === 'INVALID_NIK_FORMAT' || result.error === 'INVALID_KK_FORMAT') {
                                    showNotification('Format NIK/KK tidak valid (harus 16 digit angka)', 'error');
                                } else {
                                    showNotification(errorMsg, 'error');
                                }
                            }
                        } catch (error) {
                            console.error('Error:', error);
                            showNotification('Terjadi kesalahan saat mengirim data', 'error');
                        }
                    });
                }
        
                // Edit Surat SKTM Form
                if (editSuratSKTMForm) {
                    editSuratSKTMForm.addEventListener('submit', async (e) => {
                        e.preventDefault();
        
                        const id = document.getElementById('edit_id_sktm').value;
                        const formData = {
                            nama: document.getElementById('edit_nama').value.trim(),
                            no_kk: document.getElementById('edit_no_kk').value,
                            nik: document.getElementById('edit_nik').value,
                            tempat_tanggal_lahir: document.getElementById('edit_tempat_tanggal_lahir').value.trim(),
                            jenis_kelamin: document.getElementById('edit_jenis_kelamin').value,
                            alamat: document.getElementById('edit_alamat').value.trim(),
                            nomor_hp: document.getElementById('edit_nomor_hp').value.trim(),
                            status: document.getElementById('edit_status_sktm').value,
                            jenis_surat: 'sktm',
                            tanggal_permohonan: document.getElementById('edit_tanggal_permohonan').value
                        };
        
                        // Validate inputs
                        if (!validateNumberFormat(formData.nik, 'nik')) return;
                        if (!validateNumberFormat(formData.no_kk, 'kk')) return;
                        
                        // Validate phone number if provided
                        if (formData.nomor_hp && !formData.nomor_hp.startsWith('08')) {
                            showNotification('Nomor HP harus dimulai dengan 08', 'warning');
                            return;
                        }
        
                        try {
                            // Show loading state
                            const submitBtn = editSuratSKTMForm.querySelector('button[type="submit"]');
                            const originalBtnText = submitBtn.innerHTML;
                            submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i> Menyimpan...';
                            submitBtn.disabled = true;
        
                            const response = await fetch(`${API_BASE_URL}/${id}`, {
                                method: 'PUT',
                                headers: { 
                                    'Content-Type': 'application/json', 
                                    'Accept': 'application/json' 
                                },
                                body: JSON.stringify(formData)
                            });
        
                            const result = await response.json();
        
                            // Restore button state
                            submitBtn.innerHTML = originalBtnText;
                            submitBtn.disabled = false;
        
                            if (!response.ok) {
                                throw new Error(result.message || 'Gagal memperbarui surat');
                            }
        
                            showNotification('Surat berhasil diperbarui', 'success');
                            setTimeout(() => window.location.reload(), 1500);
                        } catch (error) {
                            console.error('Error:', error);
                            showNotification(error.message || 'Terjadi kesalahan saat memperbarui surat', 'error');
                        }
                    });
                }
            }
        
            // ==================== EDIT SURAT FUNCTION ====================
            /**
             * Edit Surat SKTM
             * @param {string} id - Surat ID
             */
            window.editSuratSKTM = async (id) => {
                try {
                    const editButton = document.querySelector(`button[onclick="editSuratSKTM('${id}')"]`);
                    if (editButton) {
                        const originalHTML = editButton.innerHTML;
                        editButton.innerHTML = '<i class="fas fa-spinner fa-spin"></i>';
                        editButton.disabled = true;
                    }
        
                    const response = await fetch(`${API_BASE_URL}/${id}`, {
                        headers: { 'Accept': 'application/json' }
                    });
        
                    const result = await response.json();
        
                    if (!response.ok) {
                        throw new Error(result.message || 'Gagal memuat data surat');
                    }
        
                    if (!result.success || !result.data) {
                        throw new Error('Data tidak ditemukan');
                    }
        
                    const data = result.data;
        
                    // Fill Edit Form
                    document.getElementById('edit_id_sktm').value = data.id;
                    document.getElementById('edit_nama').value = data.nama || '';
                    document.getElementById('edit_no_kk').value = data.no_kk || '';
                    document.getElementById('edit_nik').value = data.nik || '';
                    document.getElementById('edit_tempat_tanggal_lahir').value = data.tempat_tanggal_lahir || '';
                    document.getElementById('edit_jenis_kelamin').value = data.jenis_kelamin === 'P' ? 'P' : 'L';
                    document.getElementById('edit_alamat').value = data.alamat || '';
                    document.getElementById('edit_nomor_hp').value = data.nomor_hp || '';
                    document.getElementById('edit_status_sktm').value = data.status || 'Diproses';
                    document.getElementById('edit_tanggal_permohonan').value = data.tanggal_permohonan || '';
        
                    // Setup WhatsApp button if applicable
                    const whatsappButtonContainer = document.getElementById('whatsappButtonEditSKTM');
                    whatsappButtonContainer.innerHTML = '';
        
                    if (data.status === 'Selesai' && data.nomor_hp) {
                        let nomorWhatsApp = data.nomor_hp;
                        // Hapus bagian @s.whatsapp.net jika ada
                        if (nomorWhatsApp.includes('@s.whatsapp.net')) {
                            nomorWhatsApp = nomorWhatsApp.split('@')[0];
                        }
                        // Tambahkan kode negara jika belum ada
                        if (nomorWhatsApp.startsWith('0')) {
                            nomorWhatsApp = '+62' + nomorWhatsApp.substring(1);
                        } else if (!nomorWhatsApp.startsWith('+')) {
                            nomorWhatsApp = '+62' + nomorWhatsApp; // Asumsi default Indonesia jika tidak ada '0' atau '+'
                        }

                        const whatsappLink = document.createElement('a');
                        whatsappLink.href = `https://wa.me/${nomorWhatsApp}?text=Yth.%20${encodeURIComponent(data.nama)},%0ASurat%20Keterangan%20Tidak%20Mampu%20Anda%20dengan%20nomor%20${encodeURIComponent(data.nomor_surat || '...')}%20sudah%20selesai.%20Anda%20bisa%20mengambil%20di%20balai%20desa%20pukul%2008.00%20-%2015.00.`;
                        whatsappLink.className = 'inline-flex items-center px-3 py-1 rounded-md text-sm font-medium bg-green-100 text-green-800 hover:bg-green-200 mt-2';
                        whatsappLink.title = 'Kirim WA';
                        whatsappLink.innerHTML = '<i class="fab fa-whatsapp text-lg mr-2"></i> Kirim WA Pemberitahuan';

                        whatsappButtonContainer.appendChild(whatsappLink);
                    }
        
                    editSuratSKTMModal.classList.remove('hidden');
        
                    if (editButton) {
                        editButton.innerHTML = '<i class="fas fa-edit"></i>';
                        editButton.disabled = false;
                    }
        
                } catch (error) {
                    console.error('Error:', error);
                    showNotification('Gagal memuat data surat: ' + (error.message || 'Terjadi kesalahan'), 'error');
                    
                    if (editButton) {
                        editButton.innerHTML = '<i class="fas fa-edit"></i>';
                        editButton.disabled = false;
                    }
                }
            };
        
            // ==================== INITIALIZATION ====================
            function initialize() {
                initializeFilters();
                setupFilterListeners();
                setupModalControls();
                setupFormHandlers();
                
                // Add animation to table rows
                const tableRows = document.querySelectorAll('tbody tr');
                tableRows.forEach((row, index) => {
                    row.style.opacity = '0';
                    row.style.transform = 'translateY(20px)';
                    row.style.transition = `opacity 0.3s ease, transform 0.3s ease ${index * 0.05}s`;
                    
                    setTimeout(() => {
                        row.style.opacity = '1';
                        row.style.transform = 'translateY(0)';
                    }, 50);
                });
            }
        
            // Start the application
            initialize();
        });
        </script>
</body>
</html>