<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Surat Pengantar</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        gold: {
                            400: '#e6b800',
                            500: '#d4a900',
                            600: '#c29a00',
                            700: '#b08b00',
                        },
                        golden: {
                            50: '#fff9e6',
                            100: '#fff2cc',
                            200: '#ffe699',
                        }
                    },
                    animation: {
                        'fade-in': 'fadeIn 0.3s ease-out',
                        'slide-up': 'slideUp 0.3s ease-out',
                        'pulse-slow': 'pulse 3s infinite'
                    },
                    keyframes: {
                        fadeIn: {
                            '0%': { opacity: '0' },
                            '100%': { opacity: '1' }
                        },
                        slideUp: {
                            '0%': { transform: 'translateY(10px)', opacity: '0' },
                            '100%': { transform: 'translateY(0)', opacity: '1' }
                        }
                    }
                }
            }
        }
    </script>
    <style>
        .sidebar-link {
            transition: all 0.2s ease;
        }
        .sidebar-link:hover {
            transform: translateX(4px);
            box-shadow: 2px 0 0 0 #d4a900 inset;
        }
        .card-hover {
            transition: all 0.3s ease;
        }
        .card-hover:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
        }
        .footer-link {
            transition: all 0.2s ease;
        }
        .footer-link:hover {
            color: #d4a900;
            transform: translateY(-2px);
        }
        .active-menu {
            background-color: #fff2cc;
            color: #b08b00;
            font-weight: 600;
            border-left: 4px solid #d4a900;
        }
        .dropdown-content {
            display: none;
            position: absolute;
            right: 0;
            min-width: 280px;
            z-index: 50;
        }
        .show-dropdown {
            display: block;
            animation: fadeIn 0.3s;
        }
        .notification-badge {
            position: absolute;
            top: -5px;
            right: -5px;
        }
        .mobile-menu {
            transform: translateX(-100%);
            transition: transform 0.3s ease-in-out;
        }
        .mobile-menu.open {
            transform: translateX(0);
        }
        @media (min-width: 768px) {
            .mobile-menu {
                transform: translateX(0);
            }
        }
    </style>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body class="bg-gray-50">
    <div class="min-h-screen flex flex-col animate-fade-in">
        <!-- Header with gold gradient -->
        <nav class="bg-gradient-to-r from-gold-600 to-gold-500 p-4 text-white shadow-lg">
            <div class="container mx-auto flex justify-between items-center">
                <div class="flex items-center space-x-3 ml">
                    <div class="bg-white p-2 rounded-lg shadow-md">
                        <i class="fas fa-envelope-open-text text-gold-600 text-xl"></i>
                    </div>
                    <span class="text-xl font-bold tracking-wide">Sistem Surat Desa</span>
                </div>
                <div class="flex items-center space-x-4">
                    <div class="hidden md:block bg-gold-700 px-3 py-1 rounded-full text-sm font-medium animate-pulse-slow">
                        <i class="fas fa-circle text-xs mr-1"></i> Online
                    </div>
                </div>
            </div>
        </nav>

        <div class="flex flex-1 relative">
            <!-- Sidebar with gold accents -->
            <!-- Sidebar -->
            <button id="mobileMenuButton" class="md:hidden fixed top-4 left-4 bg-gold-500 text-white p-2 rounded-md shadow-md z-50">
                <i class="fas fa-bars"></i>
            </button>
           <!-- Sidebar -->
        <aside id="sidebar" class="mobile-menu fixed md:static inset-y-0 left-0 w-64 bg-white shadow-md p-4 border-r border-gray-200 z-50 md:block md:sticky md:top-0 md:h-screen overflow-y-auto">
            <div class="flex justify-between items-center mb-6 p-2 border-b border-gold-100 md:hidden">
                <h3 class="text-lg font-semibold">Menu Navigasi</h3>
                <button id="closeSidebar" class="text-gray-500 hover:text-gold-600">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <div class="mb-6 p-2 border-b border-gold-100">
                <h3 class="text-sm font-semibold text-gray-500 uppercase tracking-wider flex items-center">
                    <i class="fas fa-list-ul mr-2 text-gold-500"></i> Menu Surat
                </h3>
            </div>
            <ul class="space-y-2">
                <li>
                    <a href="/" class="sidebar-link flex items-center p-3 text-gray-700 hover:text-gold-700 hover:bg-golden-100 rounded-md transition-all animate-fade-in">
                        <i class="fas fa-home mr-3 text-gold-600 w-5 text-center"></i>
                        Beranda
                        <span class="ml-auto bg-gold-100 text-gold-700 text-xs px-2 py-1 rounded-full">Home</span>
                    </a>
                </li>
                <li>
                    <a href="/surat-sktm" class="sidebar-link flex items-center p-3 text-gray-700 hover:text-gold-700 hover:bg-golden-100 rounded-md transition-all animate-fade-in">
                        <i class="fas fa-hand-holding-usd mr-3 text-gold-600 w-5 text-center"></i>
                        Surat Keterangan Tidak Mampu
                    </a>
                </li>
                <li>
                    <a href="/surat-ku" class="sidebar-link flex items-center p-3 text-gray-700 hover:text-gold-700 hover:bg-golden-100 rounded-md transition-all animate-fade-in">
                        <i class="fas fa-briefcase mr-3 text-gold-600 w-5 text-center"></i>
                        Surat Keterangan Usaha
                    </a>
                </li>
                <li>
                    <a href="/surat-kbi" class="sidebar-link flex items-center p-3 text-gray-700 hover:text-gold-700 hover:bg-golden-100 rounded-md transition-all animate-fade-in">
                        <i class="fas fa-id-card mr-3 text-gold-600 w-5 text-center"></i>
                        Surat Beda Identitas
                    </a>
                </li>
                <li>
                    <a href="/surat-pengantar" class="sidebar-link flex items-center p-3 text-gray-700 hover:text-gold-700 hover:bg-golden-100 rounded-md transition-all animate-fade-in active-menu">
                        <i class="fas fa-envelope mr-3 text-gold-600 w-5 text-center"></i>
                        Surat Pengantar
                        <span class="ml-auto bg-gold-100 text-gold-700 text-xs px-2 py-1 rounded-full">New</span>
                    </a>
                </li>
            </ul>
        
            <div class="mt-8 mb-6 p-2 border-b border-gold-100">
                <h3 class="text-sm font-semibold text-gray-500 uppercase tracking-wider flex items-center">
                    <i class="fas fa-bell mr-2 text-gold-500"></i> Pemberitahuan & Riwayat
                </h3>
            </div>
            <ul class="space-y-2">
                <li>
                    <a href="/notifikasi" class="sidebar-link flex items-center p-3 text-gray-700 hover:text-gold-700 hover:bg-golden-100 rounded-md transition-all animate-fade-in">
                        <i class="fas fa-bell mr-3 text-gold-600 w-5 text-center"></i>
                        Pemberitahuan
                    </a>
                </li>
                <li>
                    <a href="/riwayat" class="sidebar-link flex items-center p-3 text-gray-700 hover:text-gold-700 hover:bg-golden-100 rounded-md transition-all animate-fade-in">
                        <i class="fas fa-history mr-3 text-gold-600 w-5 text-center"></i>
                        Riwayat
                    </a>
                </li>
            </ul>
        </aside>
        <div id="mobileOverlay" class="hidden fixed inset-0 bg-black opacity-50 z-40 md:hidden"></div>

            <main class="flex-1 p-6">
                <div class="bg-white rounded-lg shadow-md p-6 border border-gray-100">
                    <div class="flex justify-between items-center mb-6">
                        <h1 class="text-2xl font-bold text-gray-800">Daftar Surat Pengantar</h1>
                        <button id="addSuratBtn" class="bg-gold-600 hover:bg-gold-700 text-white px-4 py-2 rounded-lg shadow-md transition-all duration-200 flex items-center">
                            <i class="fas fa-plus mr-2"></i> Tambah Surat
                        </button>
                    </div>

                    <!-- Status Summary Cards with gold accents -->
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
                        <div class="bg-white border border-golden-100 rounded-lg p-4 shadow-sm hover:shadow-md transition-shadow">
                            <div class="flex justify-between items-center">
                                <div>
                                    <p class="text-gray-500 text-sm">Diproses</p>
                                    <p class="text-2xl font-bold text-gray-800"><%= statusCounts.diproses || 0 %></p>
                                </div>
                                <div class="bg-yellow-100 text-yellow-800 p-3 rounded-full">
                                    <i class="fas fa-clock text-xl"></i>
                                </div>
                            </div>
                        </div>
                        <div class="bg-white border border-golden-100 rounded-lg p-4 shadow-sm hover:shadow-md transition-shadow">
                            <div class="flex justify-between items-center">
                                <div>
                                    <p class="text-gray-500 text-sm">Selesai</p>
                                    <p class="text-2xl font-bold text-gray-800"><%= statusCounts.selesai || 0 %></p>
                                </div>
                                <div class="bg-green-100 text-green-800 p-3 rounded-full">
                                    <i class="fas fa-check-circle text-xl"></i>
                                </div>
                            </div>
                        </div>
                        <div class="bg-white border border-golden-100 rounded-lg p-4 shadow-sm hover:shadow-md transition-shadow">
                            <div class="flex justify-between items-center">
                                <div>
                                    <p class="text-gray-500 text-sm">Ditolak</p>
                                    <p class="text-2xl font-bold text-gray-800"><%= statusCounts.ditolak || 0 %></p>
                                </div>
                                <div class="bg-red-100 text-red-800 p-3 rounded-full">
                                    <i class="fas fa-times-circle text-xl"></i>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Filter and Search Section -->
                    <div class="flex flex-col md:flex-row justify-between items-start md:items-center mb-6 gap-4">
                        <div class="flex items-center space-x-2">
                            <div class="relative">
                                <select id="statusFilter" class="appearance-none bg-white border border-gray-300 rounded-md px-4 py-2 pr-8 focus:outline-none focus:ring-2 focus:ring-gold-500">
                                    <option value="semua">Semua Status</option>
                                    <option value="Diproses">Diproses</option>
                                    <option value="Selesai">Selesai</option>
                                    <option value="Ditolak">Ditolak</option>
                                </select>
                                <div class="pointer-events-none absolute inset-y-0 right-0 flex items-center px-2 text-gray-700">
                                    <i class="fas fa-chevron-down"></i>
                                </div>
                            </div>
                            
                            <div class="relative">
                                <select id="perPage" class="appearance-none bg-white border border-gray-300 rounded-md px-4 py-2 pr-8 focus:outline-none focus:ring-2 focus:ring-gold-500">
                                    <option value="5">5 per halaman</option>
                                    <option value="10" selected>10 per halaman</option>
                                    <option value="15">15 per halaman</option>
                                    <option value="20">20 per halaman</option>
                                </select>
                                <div class="pointer-events-none absolute inset-y-0 right-0 flex items-center px-2 text-gray-700">
                                    <i class="fas fa-chevron-down"></i>
                                </div>
                            </div>
                        </div>
                        
                        <div class="relative w-full md:w-64">
                            <input type="text" id="searchInput" placeholder="Cari nomor surat atau nama..." 
                                   class="w-full pl-10 pr-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-gold-500">
                            <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                                <i class="fas fa-search text-gray-400"></i>
                            </div>
                        </div>
                    </div>

                    <!-- Table -->
                    <div class="overflow-x-auto">
                        <table class="w-full border-collapse">
                            <thead>
                                <tr class="bg-golden-50 text-left">
                                    <th class="p-3 font-semibold text-gray-700">Nomor</th>
                                    <th class="p-3 font-semibold text-gray-700">Nomor Surat</th>
                                    <th class="p-3 font-semibold text-gray-700">Nama</th>
                                    <th class="p-3 font-semibold text-gray-700">Tanggal Permohonan</th>
                                    <th class="p-3 font-semibold text-gray-700">Status</th>
                                    <th class="p-3 font-semibold text-gray-700 text-right">Aksi</th>
                                </tr>
                            </thead>
                            <tbody>
                                <% if (surat.length > 0) { %>
                                    <%
                                    // Hitung offset untuk nomor urut
                                    const offset = (currentPage - 1) * perPage;
                                    surat.forEach((row, index) => { %>
                                        <tr class="border-b hover:bg-golden-50 transition-colors">
                                            <td class="p-3 text-gray-800"><%= offset + index + 1 %></td>
                                            <td class="p-3 text-gray-800"><%= row.nomor_surat %></td>
                                            <td class="p-3 text-gray-800"><%= row.nama %></td>
                                            <td class="p-3 text-gray-800"><%= new Date(row.tanggal_permohonan).toLocaleDateString('id-ID') %></td>
                                            <td class="p-3">
                                                <% if (row.status === 'Diproses') { %>
                                                    <span class="px-3 py-1 rounded-full text-xs font-semibold bg-yellow-100 text-yellow-800">
                                                        <i class="fas fa-clock mr-1"></i> <%= row.status %>
                                                    </span>
                                                <% } else if (row.status === 'Selesai') { %>
                                                    <span class="px-3 py-1 rounded-full text-xs font-semibold bg-green-100 text-green-800">
                                                        <i class="fas fa-check-circle mr-1"></i> <%= row.status %>
                                                    </span>
                                                <% } else if (row.status === 'Ditolak') { %>
                                                    <span class="px-3 py-1 rounded-full text-xs font-semibold bg-red-100 text-red-800">
                                                        <i class="fas fa-times-circle mr-1"></i> <%= row.status %>
                                                    </span>
                                                <% } %>
                                            </td>
                                            <td class="p-3 text-right">
                                                <div class="flex justify-end space-x-2">
                                                    <a href="/surat-pengantar/<%= row.id %>"
                                                       class="text-gold-600 hover:text-gold-800 p-1 rounded hover:bg-golden-50"
                                                       title="Detail">
                                                        <i class="fas fa-eye"></i>
                                                    </a>
                                                    <a href="/cetak-surat/<%= row.id %>"
                                                       class="text-green-600 hover:text-green-800 p-1 rounded hover:bg-green-50"
                                                       title="Cetak">
                                                        <i class="fas fa-print"></i>
                                                    </a>
                                                    <button onclick="editSurat('<%= row.id %>')"
                                                            class="text-purple-600 hover:text-purple-800 p-1 rounded hover:bg-purple-50"
                                                            title="Edit">
                                                        <i class="fas fa-edit"></i>
                                                    </button>
                                                    <% if (row.status === 'Selesai') { %>
                                                        <a href="https://wa.me/<%= row.nomor_wa %>?text=Yth.%20<%= encodeURIComponent(row.nama) %>,%0ASurat%20pengantar%20Anda%20dengan%20nomor%20<%= encodeURIComponent(row.nomor_surat) %>%20sudah%20selesai.%20Anda%20bisa%20mengambil%20di%20balai%20desa%20pukul%2008.00%20-%2015.00."
                                                        class="text-teal-600 hover:text-teal-800 p-1 rounded hover:bg-teal-50"
                                                        title="Kirim WA"
                                                        target="_blank">
                                                            <i class="fab fa-whatsapp"></i>
                                                        </a>
                                                    <% } %>
                                                </div>
                                            </td>
                                        </tr>
                                    <% }) %>
                                <% } else { %>
                                    <tr>
                                        <td colspan="6" class="p-4 text-center text-gray-500">
                                            <i class="fas fa-inbox text-3xl mb-2 text-gray-300"></i>
                                            <p>Tidak ada data surat.</p>
                                        </td>
                                    </tr>
                                <% } %>
                            </tbody>
                        </table>
                    
                        <% if (totalPages > 1) { %>
                            <div class="flex justify-between items-center mt-6">
                                <div class="text-sm text-gray-600">
                                    Menampilkan <%= currentPage * perPage - perPage + 1 %>-<%= Math.min(currentPage * perPage, totalItems) %> dari <%= totalItems %> surat
                                </div>
                                <div class="flex space-x-1">
                                    <% if (currentPage > 1) { %>
                                        <a href="?page=<%= currentPage - 1 %>&perPage=<%= perPage %>&status=<%= currentStatus %>&search=<%= currentSearch %>"
                                           class="px-3 py-1 border rounded hover:bg-golden-50">
                                            <i class="fas fa-chevron-left"></i>
                                        </a>
                                    <% } %>
                    
                                    <% for (let i = 1; i <= totalPages; i++) { %>
                                        <% if (i === currentPage) { %>
                                            <span class="px-3 py-1 border rounded bg-gold-600 text-white"><%= i %></span>
                                        <% } else if (i >= currentPage - 2 && i <= currentPage + 2) { %>
                                            <a href="?page=<%= i %>&perPage=<%= perPage %>&status=<%= currentStatus %>&search=<%= currentSearch %>"
                                               class="px-3 py-1 border rounded hover:bg-golden-50"><%= i %></a>
                                        <% } else if (i === 1 || i === totalPages) { %>
                                            <a href="?page=<%= i %>&perPage=<%= perPage %>&status=<%= currentStatus %>&search=<%= currentSearch %>"
                                               class="px-3 py-1 border rounded hover:bg-golden-50"><%= i %></a>
                                        <% } else if (i === currentPage - 3 || i === currentPage + 3) { %>
                                            <span class="px-3 py-1">...</span>
                                        <% } %>
                                    <% } %>
                    
                                    <% if (currentPage < totalPages) { %>
                                        <a href="?page=<%= currentPage + 1 %>&perPage=<%= perPage %>&status=<%= currentStatus %>&search=<%= currentSearch %>"
                                           class="px-3 py-1 border rounded hover:bg-golden-50">
                                            <i class="fas fa-chevron-right"></i>
                                        </a>
                                    <% } %>
                                </div>
                            </div>
                        <% } %>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <!-- Modal Tambah Surat -->
    <div id="addSuratModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center hidden z-50">
        <div class="bg-white rounded-lg shadow-xl w-full max-w-2xl max-h-screen overflow-y-auto">
            <div class="flex justify-between items-center border-b p-4">
                <h3 class="text-xl font-semibold text-gray-800">Tambah Surat Pengantar Baru</h3>
                <button id="closeAddModal" class="text-gray-500 hover:text-gray-700">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <form id="addSuratForm" class="p-6">
                <input type="hidden" id="auto_generated_fields" name="auto_generated_fields">
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <!-- Field yang diisi manual -->
                    <div>
                        <label for="new_nama" class="block text-sm font-medium text-gray-700 mb-1">Nama Lengkap*</label>
                        <input type="text" id="new_nama" name="nama" required 
                               class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-gold-500">
                    </div>
                    
                    <div>
                        <label for="new_tempat_tanggal_lahir" class="block text-sm font-medium text-gray-700 mb-1">Tempat, Tanggal Lahir*</label>
                        <input type="text" id="new_tempat_tanggal_lahir" name="tempat_tanggal_lahir" required 
                               class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-gold-500">
                    </div>
                    
                    <div>
                        <label for="new_kewarganegaraan_agama" class="block text-sm font-medium text-gray-700 mb-1">Kewarganegaraan & Agama*</label>
                        <input type="text" id="new_kewarganegaraan_agama" name="kewarganegaraan_agama" required 
                               class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-gold-500">
                    </div>
                    
                    <div>
                        <label for="new_pekerjaan" class="block text-sm font-medium text-gray-700 mb-1">Pekerjaan</label>
                        <input type="text" id="new_pekerjaan" name="pekerjaan" 
                               class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-gold-500">
                    </div>
                    
                    <div>
                        <label for="new_tempat_domisili" class="block text-sm font-medium text-gray-700 mb-1">Tempat Domisili*</label>
                        <input type="text" id="new_tempat_domisili" name="tempat_domisili" required 
                               class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-gold-500">
                    </div>
                    
                    <div>
                        <label for="new_daerah_asal" class="block text-sm font-medium text-gray-700 mb-1">Daerah Asal*</label>
                        <input type="text" id="new_daerah_asal" name="daerah_asal" required 
                               class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-gold-500">
                    </div>
                    
                    <div>
                        <label for="new_surat_bukti_diri" class="block text-sm font-medium text-gray-700 mb-1">NIK*</label>
                        <input type="text" id="new_surat_bukti_diri" name="surat_bukti_diri" required 
                               class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-gold-500">
                    </div>
                    
                    <div class="md:col-span-2">
                        <label for="new_keperluan" class="block text-sm font-medium text-gray-700 mb-1">Keperluan*</label>
                        <textarea id="new_keperluan" name="keperluan" rows="2" required 
                                  class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-gold-500"></textarea>
                    </div>
                    
                    <div class="md:col-span-2">
                        <label for="new_tujuan" class="block text-sm font-medium text-gray-700 mb-1">Tujuan*</label>
                        <textarea id="new_tujuan" name="tujuan" rows="2" required 
                                  class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-gold-500"></textarea>
                    </div>
                    
                    <!-- Field yang diisi otomatis (hanya tampilan) -->
                    <div class="md:col-span-2 p-4 bg-gray-50 rounded-lg">
                        <h4 class="font-medium text-gray-700 mb-2">Informasi Otomatis:</h4>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <p class="text-sm text-gray-500">Nomor Surat</p>
                                <p id="display_nomor_surat" class="text-sm font-medium">Akan digenerate otomatis</p>
                            </div>
                            <div>
                                <p class="text-sm text-gray-500">Jenis Surat</p>
                                <p id="display_jenis_surat" class="text-sm font-medium">Surat Pengantar</p>
                            </div>
                            <div>
                                <p class="text-sm text-gray-500">Tanggal Permohonan</p>
                                <p id="display_tanggal" class="text-sm font-medium"></p>
                            </div>
                            <div>
                                <p class="text-sm text-gray-500">Status</p>
                                <p id="display_status" class="text-sm font-medium">Diproses</p>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="mt-6 flex justify-end space-x-3">
                    <button type="button" id="cancelAddModal" class="px-4 py-2 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-100">
                        Batal
                    </button>
                    <button type="submit" class="px-4 py-2 bg-gold-600 text-white rounded-md hover:bg-gold-700">
                        <i class="fas fa-save mr-2"></i> Simpan
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal Edit Surat -->
    <div id="editSuratModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center hidden z-50">
        <div class="bg-white rounded-lg shadow-xl w-full max-w-2xl max-h-screen overflow-y-auto">
            <div class="flex justify-between items-center border-b p-4">
                <h3 class="text-xl font-semibold text-gray-800">Edit Surat Pengantar</h3>
                <button id="closeEditModal" class="text-gray-500 hover:text-gray-700">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <form id="editSuratForm" class="p-6">
                <input type="hidden" id="edit_id" name="id">
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        <label for="edit_nama" class="block text-sm font-medium text-gray-700 mb-1">Nama Lengkap*</label>
                        <input type="text" id="edit_nama" name="nama" required 
                               class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-gold-500">
                    </div>
                    
                    <div>
                        <label for="edit_tempat_tanggal_lahir" class="block text-sm font-medium text-gray-700 mb-1">Tempat, Tanggal Lahir*</label>
                        <input type="text" id="edit_tempat_tanggal_lahir" name="tempat_tanggal_lahir" required 
                               class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-gold-500">
                    </div>
                    
                    <div>
                        <label for="edit_kewarganegaraan_agama" class="block text-sm font-medium text-gray-700 mb-1">Kewarganegaraan & Agama*</label>
                        <input type="text" id="edit_kewarganegaraan_agama" name="kewarganegaraan_agama" required 
                               class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-gold-500">
                    </div>
                    
                    <div>
                        <label for="edit_pekerjaan" class="block text-sm font-medium text-gray-700 mb-1">Pekerjaan</label>
                        <input type="text" id="edit_pekerjaan" name="pekerjaan" 
                               class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-gold-500">
                    </div>
                    
                    <div>
                        <label for="edit_tempat_domisili" class="block text-sm font-medium text-gray-700 mb-1">Tempat Domisili*</label>
                        <input type="text" id="edit_tempat_domisili" name="tempat_domisili" required 
                               class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-gold-500">
                    </div>
                    
                    <div>
                        <label for="edit_daerah_asal" class="block text-sm font-medium text-gray-700 mb-1">Daerah Asal*</label>
                        <input type="text" id="edit_daerah_asal" name="daerah_asal" required 
                               class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-gold-500">
                    </div>
                    
                    <div>
                        <label for="edit_surat_bukti_diri" class="block text-sm font-medium text-gray-700 mb-1">NIK*</label>
                        <input type="text" id="edit_surat_bukti_diri" name="surat_bukti_diri" required 
                               class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-gold-500">
                    </div>
                    
                    <div class="md:col-span-2">
                        <label for="edit_keperluan" class="block text-sm font-medium text-gray-700 mb-1">Keperluan*</label>
                        <textarea id="edit_keperluan" name="keperluan" rows="2" required 
                                  class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-gold-500"></textarea>
                    </div>
                    
                    <div class="md:col-span-2">
                        <label for="edit_tujuan" class="block text-sm font-medium text-gray-700 mb-1">Tujuan*</label>
                        <textarea id="edit_tujuan" name="tujuan" rows="2" required 
                                  class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-gold-500"></textarea>
                    </div>
                    
                    <div>
                        <label for="edit_status" class="block text-sm font-medium text-gray-700 mb-1">Status*</label>
                        <select id="edit_status" name="status" required 
                                class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-gold-500">
                            <option value="Diproses">Diproses</option>
                            <option value="Selesai">Selesai</option>
                            <option value="Ditolak">Ditolak</option>
                        </select>
                    </div>
                </div>
                
                <div class="mt-6 flex justify-end space-x-3">
                    <button type="button" id="cancelEditModal" class="px-4 py-2 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-100">
                        Batal
                    </button>
                    <button type="submit" class="px-4 py-2 bg-gold-600 text-white rounded-md hover:bg-gold-700">
                        <i class="fas fa-save mr-2"></i> Simpan Perubahan
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Footer -->
    <footer class="bg-gray-800 text-white">
        <div class="container mx-auto px-4 md:px-6 py-6 md:py-8">
            <div class="flex flex-col md:flex-row justify-between">
                <div class="mb-8 md:mb-0">
                    <div class="flex items-center mb-4">
                        <div class="bg-gold-500 p-2 rounded-lg mr-3">
                            <i class="fas fa-envelope-open-text text-white"></i>
                        </div>
                        <span class="text-lg md:text-xl font-bold">Sistem Surat Desa</span>
                    </div>
                    <p class="text-gray-400 text-xs md:text-sm max-w-xs">
                        Sistem pelayanan surat menyurat digital untuk mempermudah administrasi warga Desa Kebondalem Kidul.
                    </p>
                    <p class="text-gold-400 font-semibold mt-3 md:mt-4 text-sm md:text-base">© 2025 Tim KKN Sowan Sojiwan</p>
                </div>
    
                <div class="grid grid-cols-2 md:grid-cols-3 gap-6 md:gap-8">
                    <div>
                        <h3 class="text-gold-400 font-semibold mb-3 md:mb-4 text-base md:text-lg">Navigasi</h3>
                        <ul class="space-y-1 md:space-y-2">
                            <li><a href="/" class="footer-link text-xs md:text-sm text-gray-300 hover:text-gold-400">Beranda</a></li>
                            
                            <li class="relative group">
                                <a href="#" class="footer-link text-xs md:text-sm text-gray-300 hover:text-gold-400 flex items-center">
                                    Surat 
                                    <i class="fas fa-caret-down ml-1 text-gray-400 transition-transform duration-300 group-hover:rotate-180"></i>
                                </a>
                    
                                <!-- Dropdown -->
                                <ul class="absolute left-0 top-full mt-2 w-56 bg-gray-700 rounded-md shadow-lg opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-300 ease-out z-20">
                                    <li>
                                        <a href="/surat-pengantar" class="block px-4 py-2 text-xs md:text-sm text-gray-300 hover:text-gold-400 whitespace-nowrap">Surat Pengantar</a>
                                    </li>
                                    <li>
                                        <a href="/surat-tidak-mampu" class="block px-4 py-2 text-xs md:text-sm text-gray-300 hover:text-gold-400 whitespace-nowrap">Surat Keterangan Tidak Mampu</a>
                                    </li>
                                    <li>
                                        <a href="/surat-beda-identitas" class="block px-4 py-2 text-xs md:text-sm text-gray-300 hover:text-gold-400 whitespace-nowrap">Surat Keterangan Beda Identitas</a>
                                    </li>
                                    <li>
                                        <a href="/surat-usaha" class="block px-4 py-2 text-xs md:text-sm text-gray-300 hover:text-gold-400 whitespace-nowrap">Surat Keterangan Usaha</a>
                                    </li>
                                </ul>
                            </li>
                    
                            <li><a href="/riwayat" class="footer-link text-xs md:text-sm text-gray-300 hover:text-gold-400">Riwayat</a></li>
                            <li><a href="/notifikasi" class="footer-link text-xs md:text-sm text-gray-300 hover:text-gold-400">Pemberitahuan</a></li>
                        </ul>
                    </div>
                    
                    
    
                    <div>
                        <h3 class="text-gold-400 font-semibold mb-3 md:mb-4 text-base md:text-lg">Bantuan</h3>
                        <ul class="space-y-1 md:space-y-2">
                            <li><a href="/tutorial-penggunaan" class="footer-link text-xs md:text-sm text-gray-300 hover:text-gold-400">Tutorial Penggunaan</a></li>
                            <li><a href="/faq" class="footer-link text-xs md:text-sm text-gray-300 hover:text-gold-400">FAQ</a></li>
                            <li><a href="/kebijakan-privasi" class="footer-link text-xs md:text-sm text-gray-300 hover:text-gold-400">Kebijakan Privasi</a></li>
                            <li><a href="/syarat-ketentuan" class="footer-link text-xs md:text-sm text-gray-300 hover:text-gold-400">Syarat & Ketentuan</a></li>
                        </ul>
                    </div>
    
                    <div>
                        <h3 class="text-gold-400 font-semibold mb-3 md:mb-4 text-base md:text-lg">Kontak</h3>
                        <ul class="space-y-1 md:space-y-2">
                            <li class="flex items-start">
                                <i class="fas fa-map-marker-alt text-gold-400 mr-2 mt-1 text-xs md:text-sm"></i>
                                <span class="text-xs md:text-sm text-gray-300">Desa Kebondalem Kidul, Jawa Tengah</span>
                            </li>
                            <li class="flex items-start">
                                <i class="fas fa-envelope text-gold-400 mr-2 mt-1 text-xs md:text-sm"></i>
                                <a href="mailto:desakebondalemkidul@gmail.com" class="footer-link text-xs md:text-sm text-gray-300 hover:text-gold-400">desakebondalemkidul@gmail.com</a>
                            </li>
                            <li class="flex items-start">
                                <i class="fas fa-phone-alt text-gold-400 mr-2 mt-1 text-xs md:text-sm"></i>
                                <a href="tel:+62895323350805" class="footer-link text-xs md:text-sm text-gray-300 hover:text-gold-400">+62 8953-2335-0805</a>
                            </li>
                        </ul>
                        <div class="mt-3 md:mt-4 flex space-x-3 md:space-x-4">
                            <a href="https://www.instagram.com/sowansojiwan" class="footer-link text-gray-300 hover:text-gold-400 text-base md:text-xl">
                                <i class="fab fa-instagram"></i>
                            </a>
                            <a href="https://wa.me/628562519826" class="footer-link text-gray-300 hover:text-gold-400 text-base md:text-xl">
                                <i class="fab fa-whatsapp"></i>
                            </a>
                        </div>
                    </div>
                </div>
            </div>
    
            <div class="border-t border-gray-700 mt-6 md:mt-8 pt-4 md:pt-6 text-center">
                <p class="text-gray-400 text-xs md:text-sm">
                    Sistem ini dikembangkan oleh Tim KKN UPN "VETERAN" YOGYAKARTA 2025 untuk Desa Kebondalem Kidul
                </p>
            </div>
        </div>
    </footer>

    <script>
        // Fungsi untuk menampilkan notifikasi
        function showNotification(message, type = 'success') {
            const colors = {
                success: 'bg-green-500',
                error: 'bg-red-500',
                warning: 'bg-yellow-500',
                info: 'bg-blue-500'
            };
            
            const icons = {
                success: 'fa-check-circle',
                error: 'fa-exclamation-circle',
                warning: 'fa-exclamation-triangle',
                info: 'fa-info-circle'
            };

            const notification = document.createElement('div');
            notification.className = `fixed top-4 right-4 ${colors[type]} text-white px-4 py-2 rounded-md shadow-lg flex items-center animate-fade-in`;
            notification.innerHTML = `
                <i class="fas ${icons[type]} mr-2"></i>
                <span>${message}</span>
            `;
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.classList.add('opacity-0', 'transition-opacity', 'duration-300');
                setTimeout(() => {
                    notification.remove();
                }, 300);
            }, 3000);
        }

        // ===== HANDLE MODAL =====
        document.addEventListener('DOMContentLoaded', function() {
            // Elements
            const addSuratBtn = document.getElementById('addSuratBtn');
            const addSuratModal = document.getElementById('addSuratModal');
            const closeAddModal = document.getElementById('closeAddModal');
            const cancelAddModal = document.getElementById('cancelAddModal');
            const addSuratForm = document.getElementById('addSuratForm');

            const editSuratModal = document.getElementById('editSuratModal');
            const closeEditModal = document.getElementById('closeEditModal');
            const cancelEditModal = document.getElementById('cancelEditModal');
            const editSuratForm = document.getElementById('editSuratForm');

            // ===== TAMBAH SURAT =====
            // Buka modal tambah
            if (addSuratBtn) {
                addSuratBtn.addEventListener('click', () => {
                    addSuratModal.classList.remove('hidden');
                    
                    // Set tanggal otomatis
                    const today = new Date();
                    const formattedDate = today.toLocaleDateString('id-ID', {
                        weekday: 'long',
                        year: 'numeric',
                        month: 'long',
                        day: 'numeric'
                    });
                    document.getElementById('display_tanggal').textContent = formattedDate;
                });
            }

            // Tutup modal tambah
            const closeAddSuratModal = () => {
                addSuratModal.classList.add('hidden');
                if (addSuratForm) addSuratForm.reset();
            };

            if (closeAddModal) closeAddModal.addEventListener('click', closeAddSuratModal);
            if (cancelAddModal) cancelAddModal.addEventListener('click', closeAddSuratModal);

            // Submit form tambah
            if (addSuratForm) {
                addSuratForm.addEventListener('submit', async (e) => {
                    e.preventDefault();
                    
                    const submitBtn = addSuratForm.querySelector('button[type="submit"]');
                    const originalText = submitBtn.innerHTML;
                    submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i> Menyimpan...';
                    submitBtn.disabled = true;

                    try {
                        // Validasi NIK
                        const nik = document.getElementById('new_surat_bukti_diri').value;
                        if (!/^\d{16}$/.test(nik)) {
                            throw new Error('NIK harus 16 digit angka');
                        }

                        const formData = {
                            nama: document.getElementById('new_nama').value,
                            tempat_tanggal_lahir: document.getElementById('new_tempat_tanggal_lahir').value,
                            kewarganegaraan_agama: document.getElementById('new_kewarganegaraan_agama').value,
                            pekerjaan: document.getElementById('new_pekerjaan').value,
                            tempat_domisili: document.getElementById('new_tempat_domisili').value,
                            daerah_asal: document.getElementById('new_daerah_asal').value,
                            surat_bukti_diri: nik,
                            keperluan: document.getElementById('new_keperluan').value,
                            tujuan: document.getElementById('new_tujuan').value,
                            jenis_surat: 'Surat Pengantar',
                            status: 'Diproses',
                            tanggal_permohonan: new Date().toISOString().split('T')[0]
                        };

                        // Validasi field required
                        const requiredFields = ['nama', 'tempat_tanggal_lahir', 'kewarganegaraan_agama', 
                                              'tempat_domisili', 'daerah_asal', 'surat_bukti_diri', 
                                              'keperluan', 'tujuan'];
                        const missingFields = requiredFields.filter(field => !formData[field]);
                        
                        if (missingFields.length > 0) {
                            throw new Error(`Harap isi: ${missingFields.join(', ')}`);
                        }

                        const response = await fetch('/api/surat-pengantar', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                                'Accept': 'application/json'
                            },
                            body: JSON.stringify(formData)
                        });

                        const result = await response.json();

                        if (!response.ok || !result.success) {
                            throw new Error(result.message || 'Gagal menambahkan surat');
                        }

                        showNotification('Surat berhasil ditambahkan!');
                        closeAddSuratModal();
                        
                        setTimeout(() => {
                            window.location.reload();
                        }, 1000);

                    } catch (error) {
                        console.error('Error:', error);
                        showNotification(error.message, 'error');
                    } finally {
                        submitBtn.innerHTML = originalText;
                        submitBtn.disabled = false;
                    }
                });
            }

            // ===== EDIT SURAT =====
            // Tutup modal edit
            const closeEditSuratModal = () => {
                editSuratModal.classList.add('hidden');
                if (editSuratForm) editSuratForm.reset();
            };

            if (closeEditModal) closeEditModal.addEventListener('click', closeEditSuratModal);
            if (cancelEditModal) cancelEditModal.addEventListener('click', closeEditSuratModal);

            // Submit form edit
            if (editSuratForm) {
                editSuratForm.addEventListener('submit', async (e) => {
                    e.preventDefault();
                    
                    const submitBtn = editSuratForm.querySelector('button[type="submit"]');
                    const originalText = submitBtn.innerHTML;
                    submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i> Menyimpan...';
                    submitBtn.disabled = true;

                    try {
                        const id = document.getElementById('edit_id').value;
                        const formData = {
                            nama: document.getElementById('edit_nama').value,
                            tempat_tanggal_lahir: document.getElementById('edit_tempat_tanggal_lahir').value,
                            kewarganegaraan_agama: document.getElementById('edit_kewarganegaraan_agama').value,
                            pekerjaan: document.getElementById('edit_pekerjaan').value,
                            tempat_domisili: document.getElementById('edit_tempat_domisili').value,
                            daerah_asal: document.getElementById('edit_daerah_asal').value,
                            surat_bukti_diri: document.getElementById('edit_surat_bukti_diri').value,
                            keperluan: document.getElementById('edit_keperluan').value,
                            tujuan: document.getElementById('edit_tujuan').value,
                            status: document.getElementById('edit_status').value
                        };

                        const response = await fetch(`/api/surat-pengantar/${id}`, {
                            method: 'PUT',
                            headers: {
                                'Content-Type': 'application/json',
                                'Accept': 'application/json'
                            },
                            body: JSON.stringify(formData)
                        });

                        const result = await response.json();

                        if (!response.ok || !result.success) {
                            throw new Error(result.message || 'Gagal menyimpan perubahan');
                        }

                        showNotification('Perubahan berhasil disimpan!');
                        closeEditSuratModal();
                        
                        setTimeout(() => {
                            window.location.reload();
                        }, 1000);

                    } catch (error) {
                        console.error('Error:', error);
                        showNotification(error.message, 'error');
                    } finally {
                        submitBtn.innerHTML = originalText;
                        submitBtn.disabled = false;
                    }
                });
            }

            // ===== PENCARIAN & FILTER =====
            const statusFilter = document.getElementById('statusFilter');
            const perPage = document.getElementById('perPage');
            const searchInput = document.getElementById('searchInput');
            let searchTimeout;

            // Fungsi untuk menerapkan filter dan pencarian
            function applyFilters() {
                const status = statusFilter.value;
                const limit = perPage.value;
                const search = searchInput.value.trim();
                
                let url = `/surat-pengantar?page=1&perPage=${limit}`;
                
                if (status !== 'semua') {
                    url += `&status=${status}`;
                }
                
                if (search) {
                    url += `&search=${encodeURIComponent(search)}`;
                }
                
                window.location.href = url;
            }

            // Event listeners untuk filter dan pencarian
            if (statusFilter) {
                statusFilter.addEventListener('change', applyFilters);
            }

            if (perPage) {
                perPage.addEventListener('change', applyFilters);
            }

            if (searchInput) {
                searchInput.addEventListener('input', function() {
                    clearTimeout(searchTimeout);
                    searchTimeout = setTimeout(applyFilters, 500);
                });
            }

            // Set nilai awal filter
            if (statusFilter) statusFilter.value = '<%= currentStatus || "semua" %>';
            if (perPage) perPage.value = '<%= perPage || 10 %>';
            if (searchInput) searchInput.value = '<%= currentSearch || "" %>';
        });

        // Fungsi untuk edit surat
        async function editSurat(id) {
            try {
                const modal = document.getElementById('editSuratModal');
                modal.classList.remove('hidden');
                
                // Tampilkan loading
                const title = modal.querySelector('h3');
                const originalTitle = title.textContent;
                title.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i> Memuat data...';
                
                const response = await fetch(`/api/surat-pengantar/${id}`);
                
                if (!response.ok) {
                    throw new Error(`Gagal mengambil data: ${response.status}`);
                }
                
                const result = await response.json();
                
                if (!result.success || !result.data) {
                    throw new Error('Data tidak ditemukan');
                }
                
                const data = result.data;
                
                // Isi form edit
                document.getElementById('edit_id').value = data.id;
                document.getElementById('edit_nama').value = data.nama || '';
                document.getElementById('edit_tempat_tanggal_lahir').value = data.tempat_tanggal_lahir || '';
                document.getElementById('edit_kewarganegaraan_agama').value = data.kewarganegaraan_agama || '';
                document.getElementById('edit_pekerjaan').value = data.pekerjaan || '';
                document.getElementById('edit_tempat_domisili').value = data.tempat_domisili || '';
                document.getElementById('edit_daerah_asal').value = data.daerah_asal || '';
                document.getElementById('edit_surat_bukti_diri').value = data.surat_bukti_diri || '';
                document.getElementById('edit_keperluan').value = data.keperluan || '';
                document.getElementById('edit_tujuan').value = data.tujuan || '';
                document.getElementById('edit_status').value = data.status || 'Diproses';
                
                // Kembalikan judul modal
                title.textContent = originalTitle;
                
            } catch (error) {
                console.error('Error:', error);
                showNotification(error.message || 'Gagal memuat data surat', 'error');
                document.getElementById('editSuratModal').classList.add('hidden');
            }
        }
    </script>
    <script>
        // Mobile sidebar toggle
        const mobileMenuButton = document.getElementById('mobileMenuButton');
        const closeSidebar = document.getElementById('closeSidebar');
        const sidebar = document.getElementById('sidebar');
        const mobileOverlay = document.getElementById('mobileOverlay');
    
        if (mobileMenuButton && closeSidebar && sidebar && mobileOverlay) {
            mobileMenuButton.addEventListener('click', function() {
                sidebar.classList.add('open');
                mobileOverlay.classList.remove('hidden');
                document.body.style.overflow = 'hidden';
            });
    
            closeSidebar.addEventListener('click', function() {
                sidebar.classList.remove('open');
                mobileOverlay.classList.add('hidden');
                document.body.style.overflow = '';
            });
    
            mobileOverlay.addEventListener('click', function() {
                sidebar.classList.remove('open');
                mobileOverlay.classList.add('hidden');
                document.body.style.overflow = '';
            });
    
            // Close sidebar when clicking a link (for mobile)
            const sidebarLinks = document.querySelectorAll('.sidebar-link');
            sidebarLinks.forEach(link => {
                link.addEventListener('click', function() {
                    if (window.innerWidth < 768) {
                        sidebar.classList.remove('open');
                        mobileOverlay.classList.add('hidden');
                        document.body.style.overflow = '';
                    }
                });
            });
        }
    
        // Toggle notification dropdown
        const notificationBtn = document.getElementById('notificationBtn');
        const notificationDropdown = document.getElementById('notificationDropdown');
        if (notificationBtn && notificationDropdown) {
            notificationBtn.addEventListener('click', function() {
                notificationDropdown.classList.toggle('show-dropdown');
                document.getElementById('historyDropdown')?.classList.remove('show-dropdown');
            });
        }
    
        // Toggle history dropdown
        const historyBtn = document.getElementById('historyBtn');
        const historyDropdown = document.getElementById('historyDropdown');
        if (historyBtn && historyDropdown) {
            historyBtn.addEventListener('click', function() {
                historyDropdown.classList.toggle('show-dropdown');
                document.getElementById('notificationDropdown')?.classList.remove('show-dropdown');
            });
        }
    
        // Close dropdowns when clicking outside
        window.addEventListener('click', function(event) {
            if (notificationBtn && notificationDropdown && !event.target.matches('#notificationBtn') && !event.target.closest('#notificationDropdown')) {
                notificationDropdown.classList.remove('show-dropdown');
            }
            if (historyBtn && historyDropdown && !event.target.matches('#historyBtn') && !event.target.closest('#historyDropdown')) {
                historyDropdown.classList.remove('show-dropdown');
            }
        });
    
        // Adjust main content margin when sidebar is toggled
        function adjustContentMargin() {
            const sidebarElement = document.querySelector('aside');
            if (sidebarElement) {
                const sidebarWidth = sidebarElement.offsetWidth;
                const mainElement = document.querySelector('main');
                if (mainElement) {
                    if (window.innerWidth >= 768) {
                        mainElement.style.marginLeft = `${sidebarWidth}px`;
                    } else {
                        mainElement.style.marginLeft = '0';
                    }
                }
            }
        }
    </script>
    
</body>
</html>